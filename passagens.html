<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="assets/img/logo.png" type="image/x-icon">
    <script src="https://kit.fontawesome.com/3143d98b09.js" crossorigin="anonymous"></script>
    <script src="assets/js/passagens.js"></script>
    <link rel="stylesheet" href="assets/css/style.css">
    <title>Passagens</title>
</head>
<body>
    
    <header>
        <div class="menu">
            <div class="logo"><img src="assets/img/logo.png" alt=""></div>
            <div class="pages">
                <a href="sobre.html">Sobre</a>
                <a href="passagens.html">Passagens</a>
                <a href="pacotes.html">Pacotes</a>
                <a href="blog.html">Blog</a>
                <a href="contato.html">Contato</a>
                <a href="reservas.html"><div class="circle"><img src="assets/img/icons/bag.png" alt=""></div></a>
            </div>
        </div>
    </header>

    <div class="form">
        <select  name="" id="origem">
            <option selected value="all">Todos</option>
        </select>
        <select name="" id="destino">
            <option selected value="all">Todos</option>
        </select>
        <button id="go">Procurar</button>
    </div>
    <div class="table_area">
        <div class="backgnd_table">
            <table id="passTable" cellspacing="0" cellpadding="0">
                <tr class="titles_table">
                    <th class="title_table">ORIGEM</th>
                    <th class="title_table">&nbsp;</th>
                    <th class="title_table">DESTINO</th>
                    <th class="title_table">IDA</th>
                    <th class="title_table">VOLTA</th>
                    <th class="title_table">DIAS</th>
                    <th class="title_table">PREÇO</th>
                </tr>
        </table>
    </div>
    </div>
    
</body>
<script>
    var passagens = JSON.parse(jsonpassagens)
    var origem = document.getElementById('origem')
    var destino = document.getElementById('destino')
    var table = document.getElementById('passTable')
    for(let cidade in passagens.cidades){
        let opt = document.createElement('option')
        opt.value = passagens.cidades[cidade].nome
        opt.textContent = passagens.cidades[cidade].nome
        origem.append(opt)
    }
    origem.addEventListener('change', ()=>{
        destino.innerHTML = '<option selected value="all">Todos</option>'
        var destinos = []
        
        if(origem.value != 'all'){
            for(let cidade in passagens.cidades){   
                if(passagens.cidades[cidade].nome == origem.value){
                    for(let i=0; i<passagens.cidades[cidade].viagens.length; i++){
                        destinos.push(passagens.cidades[cidade].viagens[i].destino)
                    }
                }
            }
        }
        var destinos = destinos.filter((este, i) => destinos.indexOf(este) === i);
        destinos = destinos.sort()
        for(ci of destinos){
            let opt = document.createElement('option')
            opt.value = ci
            opt.textContent = ci
            destino.append(opt)
        }
    })

    var procurar = document.getElementById('go')
    procurar.addEventListener('click', carregarTabela)

    function carregarTabela(){
        table.innerHTML = `                <tr class="titles_table">
                    <th class="title_table">ORIGEM</th>
                    <th class="title_table">&nbsp;</th>
                    <th class="title_table">DESTINO</th>
                    <th class="title_table">IDA</th>
                    <th class="title_table">VOLTA</th>
                    <th class="title_table">DIAS</th>
                    <th class="title_table">PREÇO</th>
                </tr>`
        for(i in passagens.cidades){
            if(origem.value == 'all' && destino.value == 'all'){
                for(let j in passagens.cidades[i].viagens){
                var passagem = passagens.cidades[i].viagens[j]
                putInTable(passagem)
               }
            }
            if(origem.value != 'all' && destino.value == 'all' && passagens.cidades[i].nome == origem.value){
               for(let j in passagens.cidades[i].viagens){
                var passagem = passagens.cidades[i].viagens[j]
                putInTable(passagem)
               }
            }
            if(origem.value == 'all' && destino.value != 'all'){
                for(let j in passagens.cidades[i].viagens){
                    if(passagens.cidades[i].viagens[j].destino == destino.value){
                        var passagem = passagens.cidades[i].viagens[j]
                        putInTable(passagem)
                    }
               }
            }   
            if(origem.value != 'all' && destino.value != 'all' && passagens.cidades[i].nome == origem.value){
                for(let j in passagens.cidades[i].viagens){
                    if(passagens.cidades[i].viagens[j].destino == destino.value){
                        var passagem = passagens.cidades[i].viagens[j]
                        putInTable(passagem)
                    }
               }
            } 
        }
    }
    function putInTable(passagem){
        table.innerHTML += `
                <tr>
                    <td>${passagem.origem}</td>
                    <td><i class="fa-solid fa-plane"></i></td>
                    <td>${passagem.destino}</td>
                    <td>${passagem.ida}</td>
                    <td>${passagem.volta == undefined ? "--" : passagem.volta}</td>
                    <td>${passagem["dias_de_viagem"]}</td>
                    <td style="width: 100px;"><button data-id="${passagem.id}" class="btn_preco">R$${passagem["preço"]}</button></td>
                </tr>`
    }

</script>
</html>